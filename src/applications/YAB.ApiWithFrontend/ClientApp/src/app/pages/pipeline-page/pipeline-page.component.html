<div class="h-screen w-full flex flex-col">
  <div class="content w-full grid h-full" style="grid-template-columns: auto 1fr;">
    <div class="h-full pt-4 px-6">
      <app-logo></app-logo>
      <app-navbar></app-navbar>
    </div>
    <div class="pb-4 pl-2 pt-2 pr-6 overflow-x-hidden">
      <div class="w-full mt-3 pr-2 " style="height: 53px;">
      </div>

      <div class="w-full">
        <div class="w-full justify-content-center mx-auto" style="flex-wrap: wrap;
        width: fit-content;
        margin-right: auto !important;
        margin-left: 0cm !important;">
          <div class="pr-4 pl-4 pb-4 pt-2 mb-1 mt-4 mx-auto" style="max-width: 420px;text-align: center;">
            <h3 class="font-bold text-xl px-2 mb-1.5 pt-3">{{pipelineName}}</h3>
            <span *ngIf="pipelineDescription" class="select-none">{{pipelineDescription}}</span>
          </div>

          <app-pipeline-element [marginXAuto]="true" [elementDetails]="event" [icon]="'EVENT'" [borderDefinition]="{
              'topLeft': false,
              'topRight': false,
              'bottomLeft': false,
              'bottomRight': false,
              'leftTop': false,
              'leftBottom': false,
              'lineIntoFromTop': false,
              'lineFromBottomDown': true,
              'lineFromLeftIntoRight': false
            }">
          </app-pipeline-element>


          <app-pipeline-element [marginXAuto]="true" [elementDetails]="filterBlock" [icon]="'FILTER'"
            [borderDefinition]="{
            'topLeft': false,
            'topRight': false,
            'bottomLeft': true,
            'bottomRight': false,
            'leftTop': false,
            'leftBottom': false,
            'lineIntoFromTop': true,
            'lineFromBottomDown': true,
            'lineFromLeftIntoRight': false
          }">
            <ng-template #content>
              <div>
                <ng-container [ngTemplateOutlet]="filterDetailsTemplate"
                  [ngTemplateOutletContext]="{filterBase:filter, depth: 1 }">
                </ng-container>
              </div>
            </ng-template>
          </app-pipeline-element>

          <ng-container
            *ngFor="let eventConfiguration of eventReactorConfigurations; let lastConfig = last; let index = index;">
            <app-pipeline-element [marginXAuto]="true" [icon]="'ACTION'" [borderDefinition]="{
              'topLeft': false,
              'topRight': false,
              'bottomLeft': false,
              'bottomRight': false,
              'leftTop': true,
              'leftBottom': !lastConfig,
              'lineIntoFromTop': false,
              'lineFromBottomDown': false,
              'lineFromLeftIntoRight': true
            }" [elementDetails]="eventConfiguration">
            </app-pipeline-element>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #filterDetailsTemplate let-filterBase='filterBase' let-depth='depth'>
  <div [ngClass]="'bg-gray-' + (depth * 100)" [ngStyle]="{'color': depth > 4 ? 'white': 'inherit'}"
    class="p-2.5 m-1 rounded-md">
    <ng-container *ngIf="isFilterBaseFilter(filterBase)">
      <div>
        {{stringifyEventFilters(filterBase)}}
      </div>
    </ng-container>
    <ng-container *ngIf="isFilterBaseFilterGroup(filterBase)">
      <div>
        {{stringifyEventFilters(filterBase)}}
        <div style="margin-left: 1em;" class="mt-1 pb-1">
          <ng-container *ngFor="let childFilter of filterBaseAsFilterGroup(filterBase).filters.$values"
            [ngTemplateOutlet]="filterDetailsTemplate"
            [ngTemplateOutletContext]="{filterBase:childFilter,depth: depth + 1 }">
          </ng-container>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>
